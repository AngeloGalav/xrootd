======
XRootD
======

Prerelease Notes
================

+ **New Features**
   * Allow NSWalk error messages to be routed to stderr for use by command
     line tools.
   * Add a disconnect record to the f-stream.
   * Add --infiles option to xrdcp (and follow-ons) to accept a list of input
     files via an external file. For the current xrdcp only 1 input file is
     allowed (xrdcopy has no such restriction).
   * Allow autloading of checksum plugins (this is for clients).
   * Make it obvious that version info is mandatory (use references).
   * Add new object to format and route error messages to multiple
     destinations.
   * Allow clients to easily load checksum objects via XrdCksLoader object.

+ **Major bug fixes**
   * Fix various parse issues in CpConfig. Allow -T {first|only}.
   * Do not rely in file locking to serialize inter-thread access. This
     fixes the prolem of usage file drift.
   * Correct calculation of polltab entries when using poll() type poll.
     This fixes MacOS bug 99882.
   * Fix various parse context issues in copy config with --recursive.
   * Only use the callback dispatcher ending state to determine whether the
     channel should be excluded from the poll set to avoid referencing
     deleted memory should the callback delete its own channel.
   * Recognize object deletion in the error handling path.
   * Add missing return statement to avoid SEGV during write error recovery
     under certain circumstances. Fixes bug 99002.
   * Add mutex serialization so as not to use only fcntl() locking
     as a synchronization primitive across threads. It doesn't work
     in Linux.

+ **Minor bug fixes**
   * Avoid garbled message by using stable storage for message insert.
   * Fix a post 3.1.1 regression that dropped "refresh" from kXR_locate.
   * Allow extended host specification as input to TPC.
   * Add missing instance of XrdPosixXrootd to allow local calculation
     of checksum for a remote file and increase read size to 1MB. This
     completes fix for problem 99711.
   * Do not reflect an error if we actually ended a successful checksum.
     This only applies to checksums that are externally computed and
     partially solves problem 99711.
   * Make sure to include unistd.h, this is a problem when this header
     is independently used. Patch by Brian Bockelman, UNL.
   * Fix garbled plugin message.
   * Avoid lost memory and correct computation of env length. This also fixes
     bug 99375.
   * Correct midnight calculation to properly account for time shifts.
   * Make sure error messages generated in a fork during stream execution
     appear in the log.
   * Return error message text to the client when a checksum fails.
   * Reject checksums on anything that isn't a regular file.
   * Allow for null fields in the cgi string.
   * Remove non-atomic AtomicDTZ and AtomicISM macros.
   * Do not use AtomicDTZ and AtomicISM so as to keep LinkCount and
     LinkCountMax updates truly atomic. The mentioned atomic macros
     should be removed at the next release boundary as this will
     change a public user interface.
   * Properly recognize a loaded checksum as a native checksum.

+ **Miscellaneous**
   * Allow stdin as a source in the xrdcp front-end parser. Do not
     compute doff for non-local sources.
   * Final change to f-stream monitoring. Replace standard deviation
     (sdv) calc with reporting sum of squares (ssq) counts.
   * Remove beta warning from xrdcp after xrdcpy became xrdcp.
   * Pretty up an error message. Required XrdOucERoute patch.

